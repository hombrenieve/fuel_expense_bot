apiVersion: v1
kind: Pod
metadata:
  name: fuel-bot-pod
  labels:
    app: fuel-expense-bot
spec:
  restartPolicy: Always
  terminationGracePeriodSeconds: 30
  containers:
    - name: fuel-bot-db
      image: docker.io/library/mariadb:12.1
      env:
        - name: MARIADB_ROOT_PASSWORD
          value: root_internal_pass
        - name: MARIADB_DATABASE
          value: fuel_expense_bot
        - name: MARIADB_USER
          value: fuel_bot
        - name: MARIADB_PASSWORD
          value: fuel_bot_internal_pass
      volumeMounts:
        - name: fuel-bot-data
          mountPath: /var/lib/mysql
        - name: init-scripts
          mountPath: /docker-entrypoint-initdb.d
      livenessProbe:
        exec:
          command:
            - mariadb
            - -e
            - SELECT 1
        initialDelaySeconds: 30
        periodSeconds: 30
        timeoutSeconds: 5
        failureThreshold: 3
    - name: fuel-bot-app
      image: localhost/fuel-bot:latest
      env:
        - name: TELEGRAM_TOKEN
          value: "${TELEGRAM_TOKEN}"
        - name: DEFAULT_LIMIT
          value: "210.00"
        - name: RUST_LOG
          value: telegram_fuel_bot=info
      startupProbe:
        tcpSocket:
          port: 3306
          host: localhost
        initialDelaySeconds: 10
        periodSeconds: 5
        timeoutSeconds: 3
        failureThreshold: 30
  volumes:
    - name: fuel-bot-data
      persistentVolumeClaim:
        claimName: fuel-bot-pvc
    - name: init-scripts
      hostPath:
        path: ./scripts
        type: Directory
